{% extends 'app/app.base.html.twig' %}

{% block page_content %}
    {% set review = reviewModel.review %}
    {% set revisions = review.revisions %}

    <h3 class="mt-2">{{ 'CR-' ~ review.id ~ ' ' ~ review.title }}</h3>
    State: {{ review.state }}

    {% if reviewModel.isReviewer(app.user) and review.state == 'open' %}
        <form method="POST" class="d-inline-block"
              action="{{ path('DR\\GitCommitNotification\\Controller\\App\\Review\\ChangeReviewerState', {id: review.id}) }}">
            <input type="hidden" name="state" value="accepted"/>
            <button type="submit" class="btn btn-outline-success btn-sm">ðŸ˜ƒ {{ 'Accept' }}</button>
        </form>

        <form method="POST" class="d-inline-block"
              action="{{ path('DR\\GitCommitNotification\\Controller\\App\\Review\\ChangeReviewerState', {id: review.id}) }}">
            <input type="hidden" name="state" value="rejected"/>
            <button type="submit" class="btn btn-outline-primary btn-sm">ðŸ˜ž {{ 'Raise concern' }}</button>
        </form>
    {% endif %}

    {% if review.state == 'open' %}
        <form method="POST" class="d-inline-block"
              action="{{ path('DR\\GitCommitNotification\\Controller\\App\\Review\\ChangeReviewState', {id: review.id}) }}">
            <input type="hidden" name="state" value="closed"/>
            <button type="submit" class="btn btn-outline-dark btn-sm">{{ 'Close review' }}</button>
        </form>
    {% elseif review.state == 'closed' %}
        <form method="POST" class="d-inline-block"
              action="{{ path('DR\\GitCommitNotification\\Controller\\App\\Review\\ChangeReviewState', {id: review.id}) }}">
            <input type="hidden" name="state" value="open"/>
            <button type="submit" class="btn btn-outline-dark btn-sm">{{ 'Reopen review' }}</button>
        </form>
    {% endif %}

    <fieldset>
        <legend>Revisions</legend>
        {% for revision in revisions %}
            {{ revision.commitHash }}<br>
        {% endfor %}
    </fieldset>

    <fieldset>
        <legend>Author</legend>
        {% for email, name in reviewModel.authors %}
            {{ name }}<br>
        {% endfor %}
    </fieldset>

    <fieldset>
        <legend>Reviewers</legend>
        {% for reviewer in review.reviewers %}
            {{ reviewer.user.name }} ({{ reviewer.state }})

            <form method="POST" class="d-inline-block"
                  action="{{ path('DR\\GitCommitNotification\\Controller\\App\\Review\\RemoveReviewerController', {reviewerId: reviewer.id, reviewId: review.id}) }}">
                <input type="hidden" name="_method" value="DELETE"/>
                <button type="submit" class="btn btn-danger btn-sm">
                    <i class="bi-trash"></i>
                </button>
            </form><br>

        {% endfor %}

        {{ form(reviewModel.addReviewerForm) }}
    </fieldset>

    <fieldset>
        <legend>Files</legend>
        {% for file in reviewModel.files %}
            <a href="?filePath={{ file.file.pathname|e('url') }}">
                {{ file.filename }}
            </a><br>
        {% endfor %}
    </fieldset>

    {%- set line_nr_length_before = 5 -%}
    {%- set line_nr_length_after = 5 -%}
    {% include 'commit/commit.file.html.twig' with {file: reviewModel.selectedFile} %}

{% endblock %}
