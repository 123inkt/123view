{%- import "app/review/commit/commit.line.macros.html.twig" as macro -%}
{#- fileDiffViewModel:  FileDiffViewModel -#}
{#- line:               DiffLine          -#}
{#- line_visible:       bool              -#}
{#- lineNrLengthBefore: int               -#}
{#- lineNrLengthAfter:  int               -#}
<div class="diff-file__diff-line {{ macro.line_style(line, line_visible) }}"
     data-role="diff-line"
     data-line="{{ line_number }}"
     data-line-offset="{{ line_offset }}"
     data-line-after="{{ line.lineNumberAfter|default('0') }}"
>
    {#- gutter -#}
    {{ macro.gutter(line, lineNrLengthBefore, lineNrLengthAfter) }}

    {#- line state -#}
    <span class="diff-file__diff-change-state">{{ macro.line_modifier(line) }}</span>

    {#- code changes -#}
    {%- if fileDiffViewModel.highlightedFile != null and line.changes|length == 1 and line.state != 2 -%}
        {{- fileDiffViewModel.highlightedFile.getLine(line.lineNumberAfter ?? line.lineNumberBefore ?? 0)|raw -}}
    {%- else -%}
        {{ macro.changes(line) }}
    {%- endif -%}
</div>
