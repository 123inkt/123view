{% extends 'app/app.base.html.twig' %}

{% block page_content %}
    {% set form = editRuleModel.form %}

    <div data-controller="edit-rule" data-edit-rule-recipient-count-value="{{ form.rule.recipients|length }}">

        <h1 class="mt-2">{{ 'New rule'|trans }}</h1>

        {{ form_start(form) }}

        {# rule #}
        {{ form_label(form.rule.name) }}
        {{ form_widget(form.rule.name) }}

        {{ form_label(form.rule.active) }}
        {{ form_widget(form.rule.active) }}

        {{ form_label(form.rule.ruleOptions.frequency) }}
        {{ form_widget(form.rule.ruleOptions.frequency) }}

        {# recipients #}
        <fieldset class="pb-2">
            <legend>Recipients</legend>

            <div data-role="recipients" data-edit-rule-target="recipients">
                {% for recipient in form.rule.recipients %}
                    <div class="row pb-2" data-edit-rule-target="recipient">
                        <div class="col-5">
                            {{ form_widget(recipient.email) }}
                        </div>
                        <div class="col-5">
                            {{ form_widget(recipient.name) }}
                        </div>

                        <div class="col">
                            <a href="javascript:" data-action="edit-rule#deleteRecipient" class="btn btn-outline-danger">&times;</a>
                        </div>
                    </div>
                {% endfor %}
            </div>

            <template data-edit-rule-target="recipientTemplate">
                {% set recipient = form.rule.recipients.vars.prototype %}
                <div class="row pb-2" data-edit-rule-target="recipient">
                    <div class="col-5">
                        {{ form_widget(recipient.email) }}
                    </div>
                    <div class="col-5">
                        {{ form_widget(recipient.name) }}
                    </div>

                    <div class="col">
                        <a href="javascript:" data-action="edit-rule#deleteRecipient" class="btn btn-outline-danger">&times;</a>
                    </div>
                </div>
            </template>

            <a href="javascript:" data-action="edit-rule#addRecipient" class="btn btn-outline-primary">
                {{ 'Add recipient'|trans }}
            </a>

        </fieldset>

        {{ form_end(form) }}

    </div>
{% endblock %}
